# Списки

## Содержание

- [Рендеринг массивов](#рендеринг-массивов)
- [Повторяющиеся шаблоны с использованием `map`](#повторяющиеся-шаблоны-с-использованием-map)
- [Повторяющиеся шаблоны с использованием операторов цикла](#повторяющиеся-шаблоны-с-использованием-операторов-цикла)
- [Директива `repeat`](#директива-repeat)
    - [Когда использовать `map` или `repeat`](#когда-использовать-map-или-repeat)

---
Вы можете использовать стандартные конструкции JavaScript для создания повторяющихся шаблонов.

@metafor/html также предоставляет директиву `repeat` для более эффективного создания определённых типов динамических списков.

---

## Рендеринг массивов

Когда выражение в позиции дочернего элемента возвращает массив или итерируемый объект, @metafor/html рендерит все элементы массива:

```javascript
html`
  <ul>
    ${['Item 1', 'Item 2', 'Item 3']}
  </ul>
`;
```

В большинстве случаев вам нужно преобразовать элементы массива в более удобную форму, например:

```javascript
html`
  <ul>
    ${this.items.map(item => html`<li>${item}</li>`)}
  </ul>
`;
```

---

## Повторяющиеся шаблоны с использованием `map`

Для отображения списков можно использовать метод `map`, чтобы преобразовать список данных в список шаблонов. Например:

```javascript
html`
  <ul>
    ${this.items.map(item => html`<li>${item}</li>`)}
  </ul>
`;
```

В данном примере:

- `this.items` — это массив данных, таких как `['Item 1', 'Item 2']`.
- Каждый элемент массива преобразуется в шаблон `<li>${item}</li>`.

Данное выражение возвращает массив объектов `TemplateResult`. @metafor/html рендерит массив или итерируемый объект, содержащий подшаблоны и другие значения.

---

## Повторяющиеся шаблоны с использованием операторов цикла

Вы также можете создать массив шаблонов вручную, используя циклы, и передать его в выражение шаблона:

```javascript
render()
{
  const itemTemplates = [];
  for (const item of this.items) {
    itemTemplates.push(html`<li>${item}</li>`);
  }
  return html`
    <ul>
      ${itemTemplates}
    </ul>
  `;
}
```

---

## Директива `repeat`

В большинстве случаев использование циклов или `map` эффективно для построения повторяющихся шаблонов. Однако, если требуется изменить порядок большого списка или модифицировать его, добавляя и удаляя отдельные записи, это
может привести к обновлению большого количества DOM-узлов.

Директива `repeat` помогает в таких случаях. Она выполняет эффективное обновление списков на основе пользовательских ключей:

```javascript
repeat(items, keyFunction, itemTemplate)
```

### Где:

- `items` — массив или итерируемый объект.
- `keyFunction` — функция, которая принимает один элемент и возвращает уникальный ключ для этого элемента.
- `itemTemplate` — функция-шаблон, принимающая элемент и его текущий индекс, и возвращающая `TemplateResult`.

### Пример:

```javascript
html`
  <ul>
    ${repeat(this.items, item => item.id, item => html`<li>${item.name}</li>`)}
  </ul>
`;
```

Если вы отсортируете массив `items`, директива `repeat` изменит порядок существующих DOM-узлов, а не создаст новые.

---

### Когда использовать `map` или `repeat`

Выбор между `map` и `repeat` зависит от ситуации:

1. **Используйте `repeat`, если:**
    - Обновление DOM-узлов более затратное, чем их перемещение.
    - DOM-узлы имеют состояние, не управляемое шаблоном.

   Пример:

   ```javascript
   html`
     ${this.users.map(user => html`
       <div>
         <input type="checkbox">
         ${user.name}
       </div>
     `)}
   `;
   ```

   В этом примере состояние чекбоксов не контролируется шаблоном. Если вы измените порядок списка, @metafor/html обновит имена, но состояние чекбоксов останется прежним.

2. **Используйте `map` или циклы**, если указанные выше условия не применимы.

---

## Резюме

- Используйте `map` для простого отображения данных в шаблоны.
- Используйте циклы для создания массивов шаблонов вручную.
- Используйте `repeat`, если требуется производительность при перемещении DOM-узлов или сохранение состояния узлов.

---